# GitLab Community Edition - Optimized for local development
# This configuration minimizes resource usage and startup time

global:
  edition: ce
  hosts:
    # Domain: Using nip.io for automatic DNS resolution
    # nip.io is a free wildcard DNS service that resolves to the embedded IP
    # Example: gitlab.127.0.0.1.nip.io -> 127.0.0.1
    #
    # Why nip.io?
    # 1. GitLab requires a domain name (won't work with bare IP)
    # 2. Ingress routing needs hostnames for the Host header
    # 3. No /etc/hosts editing required
    # 4. Works automatically without any DNS setup
    #
    # Alternative: Use /etc/hosts with custom domain like "gitlab.local"
    domain: 127.0.0.1.nip.io
    https: false
    gitlab:
      serviceName: gitlab-webservice-default
      servicePort: 8181
  ingress:
    class: traefik
    tls:
      enabled: false
    configureCertmanager: false
  appConfig:
    enableUsagePing: false
    enableSeatLink: false
    # Disable all object storage features for faster startup
    artifacts:
      enabled: false
    lfs:
      enabled: false
    uploads:
      enabled: false
    packages:
      enabled: false
    object_store:
      enabled: false

  # Disable unused services
  kas:
    enabled: false

  minio:
    enabled: false

# Disable unnecessary components
installCertmanager: false

nginx-ingress:
  enabled: false

registry:
  enabled: false

gitlab-runner:
  install: false

prometheus:
  install: false

grafana:
  enabled: false

# Configure GitLab components with minimal replicas and optimized settings
gitlab:
  webservice:
    minReplicas: 1
    maxReplicas: 1
    resources:
      requests:
        cpu: 200m
        memory: 1Gi
      limits:
        cpu: 1
        memory: 2Gi
    # Tune probes for faster readiness
    livenessProbe:
      initialDelaySeconds: 20
      periodSeconds: 10
    readinessProbe:
      initialDelaySeconds: 20
      periodSeconds: 5

  sidekiq:
    minReplicas: 1
    maxReplicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi

  gitaly:
    minReplicas: 1
    maxReplicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

  toolbox:
    backups:
      enabled: false
      # Disable object storage backups for local development
      objectStorage:
        enabled: false
        config:
          secret: gitlab-backup-empty
          key: config
      # Disable automatic backup cron
      cron:
        enabled: false

# PostgreSQL optimization
postgresql:
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Redis optimization
redis:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
